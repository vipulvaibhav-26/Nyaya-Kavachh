<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopHub - Advanced E-Commerce Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --dark: #1f2937;
            --light: #f9fafb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light);
        }

        .navbar {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem 0;
        }

        .navbar-brand {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary) !important;
        }

        .nav-link {
            color: var(--dark) !important;
            font-weight: 500;
            margin: 0 0.5rem;
            transition: color 0.3s;
        }

        .nav-link:hover {
            color: var(--primary) !important;
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
        }

        .hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 5rem 0;
            margin-bottom: 3rem;
        }

        .hero h1 {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .search-container {
            max-width: 800px;
            margin: 2rem auto;
        }

        .search-input {
            border-radius: 50px;
            padding: 1rem 2rem;
            border: 2px solid #e5e7eb;
        }

        .search-btn {
            border-radius: 50px;
            padding: 1rem 2rem;
            background: var(--primary);
            border: none;
        }

        .product-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            margin-bottom: 2rem;
            height: 100%;
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .product-img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        .product-body {
            padding: 1.5rem;
        }

        .product-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .product-price {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .btn-primary-custom {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .btn-primary-custom:hover {
            background: var(--primary-dark);
        }

        .modal-content {
            border-radius: 15px;
        }

        .modal-header {
            background: var(--primary);
            color: white;
            border-radius: 15px 15px 0 0;
        }

        .cart-item {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .cart-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
        }

        footer {
            background: var(--dark);
            color: white;
            padding: 3rem 0 1rem;
            margin-top: 5rem;
        }

        .footer-links a {
            color: #9ca3af;
            text-decoration: none;
            display: block;
            margin-bottom: 0.5rem;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: white;
        }

        .social-icons a {
            color: white;
            font-size: 1.5rem;
            margin-right: 1rem;
            transition: color 0.3s;
        }

        .social-icons a:hover {
            color: var(--primary);
        }

        .category-badge {
            display: inline-block;
            padding: 0.3rem 1rem;
            background: var(--light);
            border-radius: 20px;
            margin: 0.3rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .category-badge:hover, .category-badge.active {
            background: var(--primary);
            color: white;
        }

        .seller-card {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.25);
        }

        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .checkout-summary {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: sticky;
            top: 100px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            z-index: 1000;
        }

        .status-online {
            background: #10b981;
            color: white;
        }

        .status-offline {
            background: #ef4444;
            color: white;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="toast-container"></div>
    <div id="connectionStatus" class="connection-status" style="display:none;"></div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#"><i class="fas fa-shopping-bag"></i> ShopHub</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('home')">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('products')">Products</a>
                    </li>
                    <li class="nav-item" id="sellerNavItem" style="display:none;">
                        <a class="nav-link" href="#" onclick="showSection('seller')">Dashboard</a>
                    </li>
                    <li class="nav-item" id="ordersNavItem" style="display:none;">
                        <a class="nav-link" href="#" onclick="showSection('orders')">My Orders</a>
                    </li>
                    <li class="nav-item position-relative">
                        <a class="nav-link" href="#" onclick="showCart()">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="cart-badge" id="cartCount">0</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="handleAuthClick()" id="authBtn">
                            <i class="fas fa-user"></i> Login
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div id="mainContent">
        <section class="hero text-center">
            <div class="container">
                <h1 class="fade-in">Welcome to ShopHub</h1>
                <p class="lead fade-in">Your Ultimate Shopping Destination with Secure MySQL Backend</p>
            </div>
        </section>

        <div class="container search-container">
            <div class="input-group">
                <input type="text" class="form-control search-input" id="searchInput" placeholder="Search for products...">
                <button class="btn btn-primary search-btn" onclick="searchProducts()">
                    <i class="fas fa-search"></i> Search
                </button>
            </div>
        </div>

        <div class="container mb-4">
            <h3 class="mb-3">Categories</h3>
            <div id="categoriesContainer">
                <span class="category-badge active" onclick="filterByCategory('all')">All</span>
                <span class="category-badge" onclick="filterByCategory('Electronics')">Electronics</span>
                <span class="category-badge" onclick="filterByCategory('Fashion')">Fashion</span>
                <span class="category-badge" onclick="filterByCategory('Home')">Home & Living</span>
                <span class="category-badge" onclick="filterByCategory('Sports')">Sports</span>
            </div>
        </div>

        <div class="container">
            <h2 class="mb-4">Featured Products</h2>
            <div class="row" id="productsGrid">
                <div class="col-12 text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login/Register Modal -->
    <div class="modal fade" id="authModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Login / Register</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs mb-3" id="authTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login">Login</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register">Register</button>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="login">
                            <form id="loginForm" onsubmit="handleLogin(event)">
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" name="email" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Password</label>
                                    <input type="password" name="password" class="form-control" required>
                                </div>
                                <button type="submit" class="btn btn-primary-custom w-100">
                                    <span class="btn-text">Login</span>
                                </button>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="register">
                            <form id="registerForm" onsubmit="handleRegister(event)">
                                <div class="mb-3">
                                    <label class="form-label">Full Name</label>
                                    <input type="text" name="name" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" name="email" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Password</label>
                                    <input type="password" name="password" class="form-control" minlength="6" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">I want to be a</label>
                                    <select name="role" class="form-select">
                                        <option value="buyer">Buyer</option>
                                        <option value="seller">Seller</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary-custom w-100">
                                    <span class="btn-text">Register</span>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal fade" id="cartModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Shopping Cart</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="cartItems"></div>
                    <div class="d-flex justify-content-between align-items-center mt-4">
                        <h4>Total: <span id="cartTotal">$0.00</span></h4>
                        <button class="btn btn-primary-custom btn-lg" onclick="proceedToCheckout()">
                            Proceed to Checkout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Seller Dashboard -->
    <div id="sellerDashboard" style="display:none;">
        <div class="container mt-5">
            <h2 class="mb-4">Seller Dashboard</h2>
            
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="stat-card">
                        <h5>Total Products</h5>
                        <h2 id="totalProducts">0</h2>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                        <h5>Total Revenue</h5>
                        <h2 id="totalRevenue">$0</h2>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                        <h5>Total Orders</h5>
                        <h2 id="totalOrders">0</h2>
                    </div>
                </div>
            </div>

            <div class="seller-card mb-4">
                <h4 class="mb-3">Add New Product</h4>
                <form id="addProductForm" onsubmit="addProduct(event)">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Product Name</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Price</label>
                            <input type="number" class="form-control" name="price" step="0.01" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Category</label>
                            <select class="form-select" name="category" required>
                                <option value="Electronics">Electronics</option>
                                <option value="Fashion">Fashion</option>
                                <option value="Home">Home & Living</option>
                                <option value="Sports">Sports</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Stock Quantity</label>
                            <input type="number" class="form-control" name="stock_quantity" value="10" required>
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">Image URL</label>
                            <input type="url" class="form-control" name="image_url" required>
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" name="description" rows="3" required></textarea>
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary-custom">
                                <i class="fas fa-plus"></i> Add Product
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <div class="seller-card">
                <h4 class="mb-3">My Products</h4>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Category</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="sellerProductsList"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Orders Page -->
    <div id="ordersPage" style="display:none;">
        <div class="container mt-5">
            <h2 class="mb-4">My Orders</h2>
            <div id="ordersList"></div>
        </div>
    </div>

    <!-- Checkout Page -->
    <div id="checkoutPage" style="display:none;">
        <div class="container mt-5">
            <h2 class="mb-4">Checkout</h2>
            <div class="row">
                <div class="col-md-7">
                    <div class="seller-card mb-4">
                        <h4 class="mb-3">Shipping Information</h4>
                        <form id="checkoutForm" onsubmit="completeOrder(event)">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">First Name</label>
                                    <input type="text" class="form-control" name="firstName" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Last Name</label>
                                    <input type="text" class="form-control" name="lastName" required>
                                </div>
                                <div class="col-12 mb-3">
                                    <label class="form-label">Address</label>
                                    <input type="text" class="form-control" name="address" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">City</label>
                                    <input type="text" class="form-control" name="city" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Postal Code</label>
                                    <input type="text" class="form-control" name="postalCode" required>
                                </div>
                                <div class="col-12 mb-3">
                                    <label class="form-label">Phone</label>
                                    <input type="tel" class="form-control" name="phone" required>
                                </div>
                            </div>
                            
                            <h4 class="mb-3 mt-4">Payment Information</h4>
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <label class="form-label">Payment Method</label>
                                    <select class="form-select" name="payment_method" required>
                                        <option value="Credit Card">Credit Card</option>
                                        <option value="Debit Card">Debit Card</option>
                                        <option value="PayPal">PayPal</option>
                                        <option value="Cash on Delivery">Cash on Delivery</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary-custom btn-lg w-100 mt-3">
                                <i class="fas fa-lock"></i> Complete Order
                            </button>
                        </form>
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="checkout-summary">
                        <h4 class="mb-3">Order Summary</h4>
                        <div id="checkoutItems"></div>
                        <hr>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal</span>
                            <span id="checkoutSubtotal">$0.00</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <h5>Total</h5>
                            <h5 id="checkoutTotal">$0.00</h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4">
                    <h4 class="mb-3"><i class="fas fa-shopping-bag"></i> ShopHub</h4>
                    <p>Your trusted online marketplace with secure MySQL backend and REST API.</p>
                    <div class="social-icons mt-3">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
                <div class="col-md-2 mb-4">
                    <h5 class="mb-3">Shop</h5>
                    <div class="footer-links">
                        <a href="#">Electronics</a>
                        <a href="#">Fashion</a>
                        <a href="#">Home & Living</a>
                        <a href="#">Sports</a>
                    </div>
                </div>
                <div class="col-md-2 mb-4">
                    <h5 class="mb-3">Company</h5>
                    <div class="footer-links">
                        <a href="#">About Us</a>
                        <a href="#">Careers</a>
                        <a href="#">Press</a>
                        <a href="#">Blog</a>
                    </div>
                </div>
                <div class="col-md-2 mb-4">
                    <h5 class="mb-3">Support</h5>
                    <div class="footer-links">
                        <a href="#">Help Center</a>
                        <a href="#">Contact Us</a>
                        <a href="#">Shipping</a>
                        <a href="#">Returns</a>
                    </div>
                </div>
                <div class="col-md-2 mb-4">
                    <h5 class="mb-3">Legal</h5>
                    <div class="footer-links">
                        <a href="#">Privacy Policy</a>
                        <a href="#">Terms of Service</a>
                        <a href="#">Cookie Policy</a>
                    </div>
                </div>
            </div>
            <hr style="border-color: #4b5563;">
            <div class="text-center py-3">
                <p class="mb-0">&copy; 2025 ShopHub. Powered by Node.js, Express & MySQL</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ============================================
        // API CONFIGURATION - CHANGE THIS TO YOUR BACKEND URL
        // ============================================
        const API_URL = 'http://localhost:5000/api';
        
        // ============================================
        // APPLICATION STATE
        // ============================================
        let currentUser = null;
        let authToken = null;
        let cartData = { items: [], total: 0 };

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initializing ShopHub...');
            checkBackendConnection();
            checkAuthStatus();
            loadProducts();
            
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchProducts();
            });
        });

        // ============================================
        // BACKEND CONNECTION CHECK
        // ============================================
        async function checkBackendConnection() {
            try {
                const response = await fetch(`${API_URL}/health`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    console.log('‚úÖ Backend connected successfully');
                    showConnectionStatus('Backend Connected', true);
                } else {
                    throw new Error('Backend health check failed');
                }
            } catch (error) {
                console.error('‚ùå Backend connection failed:', error);
                showConnectionStatus('Backend Offline - Please start the server', false);
                showToast('Backend server is not running. Please start it with: npm run dev', 'error');
            }
        }

        function showConnectionStatus(message, isOnline) {
            const status = document.getElementById('connectionStatus');
            status.textContent = message;
            status.className = `connection-status ${isOnline ? 'status-online' : 'status-offline'}`;
            status.style.display = 'block';
            
            if (isOnline) {
                setTimeout(() => {
                    status.style.display = 'none';
                }, 3000);
            }
        }

        // ============================================
        // AUTHENTICATION
        // ============================================
        function checkAuthStatus() {
            authToken = localStorage.getItem('token');
            const userStr = localStorage.getItem('user');
            
            console.log('Checking auth status...', { hasToken: !!authToken, hasUser: !!userStr });
            
            if (authToken && userStr) {
                try {
                    currentUser = JSON.parse(userStr);
                    console.log('‚úÖ User authenticated:', currentUser);
                    
                    // Update UI for logged in user
                    document.getElementById('authBtn').innerHTML = `
                        <i class="fas fa-user-circle"></i> ${currentUser.name} 
                        <i class="fas fa-sign-out-alt ms-2" title="Logout"></i>
                    `;
                    
                    // Show role-specific nav items
                    if (currentUser.role === 'seller') {
                        document.getElementById('sellerNavItem').style.display = 'block';
                    }
                    document.getElementById('ordersNavItem').style.display = 'block';
                    
                    // Load cart for authenticated user
                    loadCart();
                } catch (error) {
                    console.error('Error parsing user data:', error);
                    logout();
                }
            } else {
                console.log('‚ÑπÔ∏è No authenticated user');
            }
        }

        function handleAuthClick() {
            if (currentUser) {
                logout();
            } else {
                new bootstrap.Modal(document.getElementById('authModal')).show();
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const btn = form.querySelector('button[type="submit"]');
            const btnText = btn.querySelector('.btn-text');
            
            console.log('Attempting login...');
            btnText.innerHTML = '<span class="loading"></span>';
            btn.disabled = true;

            try {
                const loginData = {
                    email: formData.get('email'),
                    password: formData.get('password')
                };

                console.log('Sending login request to:', `${API_URL}/auth/login`);

                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(loginData)
                });

                const data = await response.json();
                console.log('Login response:', { status: response.status, data });

                if (!response.ok) {
                    throw new Error(data.error || data.message || 'Login failed');
                }

                // Store authentication data
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                authToken = data.token;
                currentUser = data.user;

                console.log('‚úÖ Login successful:', currentUser);

                // Close modal and update UI
                bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
                showToast(`Welcome back, ${currentUser.name}!`);
                checkAuthStatus();
                form.reset();
                
                // Reload products and cart
                loadProducts();
                loadCart();
            } catch (error) {
                console.error('‚ùå Login error:', error);
                showToast(error.message, 'error');
            } finally {
                btnText.textContent = 'Login';
                btn.disabled = false;
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const btn = form.querySelector('button[type="submit"]');
            const btnText = btn.querySelector('.btn-text');
            
            console.log('Attempting registration...');
            btnText.innerHTML = '<span class="loading"></span>';
            btn.disabled = true;

            try {
                const registerData = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    password: formData.get('password'),
                    role: formData.get('role')
                };

                console.log('Sending registration request to:', `${API_URL}/auth/register`);

                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(registerData)
                });

                const data = await response.json();
                console.log('Registration response:', { status: response.status, data });

                if (!response.ok) {
                    const errorMsg = data.error || data.errors?.[0]?.msg || 'Registration failed';
                    throw new Error(errorMsg);
                }

                // Store authentication data
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                authToken = data.token;
                currentUser = data.user;

                console.log('‚úÖ Registration successful:', currentUser);

                // Close modal and update UI
                bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
                showToast(`Welcome to ShopHub, ${currentUser.name}!`);
                checkAuthStatus();
                form.reset();
                
                loadProducts();
                loadCart();
            } catch (error) {
                console.error('‚ùå Registration error:', error);
                showToast(error.message, 'error');
            } finally {
                btnText.textContent = 'Register';
                btn.disabled = false;
            }
        }

        function logout() {
            console.log('Logging out...');
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            authToken = null;
            currentUser = null;
            cartData = { items: [], total: 0 };
            
            document.getElementById('authBtn').innerHTML = '<i class="fas fa-user"></i> Login';
            document.getElementById('sellerNavItem').style.display = 'none';
            document.getElementById('ordersNavItem').style.display = 'none';
            updateCartBadge();
            showToast('Logged out successfully');
            showSection('home');
        }

        // ============================================
        // PRODUCTS
        // ============================================
        async function loadProducts(filter = {}) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '<div class="col-12 text-center"><div class="spinner-border text-primary"></div><p class="mt-2">Loading products from database...</p></div>';

            try {
                const params = new URLSearchParams(filter);
                console.log('Fetching products:', `${API_URL}/products?${params}`);
                
                const response = await fetch(`${API_URL}/products?${params}`);
                const products = await response.json();

                console.log('Products loaded:', products.length);

                if (!response.ok) throw new Error('Failed to load products');

                renderProducts(products);
            } catch (error) {
                console.error('‚ùå Load products error:', error);
                grid.innerHTML = `
                    <div class="col-12 text-center">
                        <h5 class="text-danger">Failed to load products</h5>
                        <p>Make sure the backend server is running</p>
                        <button class="btn btn-primary-custom" onclick="loadProducts()">Retry</button>
                    </div>
                `;
            }
        }

        function renderProducts(products) {
            const grid = document.getElementById('productsGrid');
            
            if (products.length === 0) {
                grid.innerHTML = `
                    <div class="col-12 text-center">
                        <h4>No products found</h4>
                        <p>Be the first to add products as a seller!</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = '';
            products.forEach(product => {
                const col = document.createElement('div');
                col.className = 'col-md-4 fade-in';
                col.innerHTML = `
                    <div class="product-card">
                        <img src="${product.image_url}" class="product-img" alt="${product.name}" 
                             onerror="this.src='https://via.placeholder.com/500x500?text=No+Image'">
                        <div class="product-body">
                            <div class="product-title">${product.name}</div>
                            <div class="text-muted mb-2"><i class="fas fa-tag"></i> ${product.category}</div>
                            <p class="text-muted small">${product.description || 'No description'}</p>
                            <div class="product-price">${parseFloat(product.price).toFixed(2)}</div>
                            <div class="text-muted mb-3">
                                <i class="fas fa-box"></i> Stock: ${product.stock_quantity}
                                ${product.seller_name ? `<br><i class="fas fa-store"></i> ${product.seller_name}` : ''}
                            </div>
                            <button class="btn btn-primary-custom w-100" 
                                    onclick="addToCart(${product.id})" 
                                    ${product.stock_quantity <= 0 ? 'disabled' : ''}>
                                <i class="fas fa-cart-plus"></i> 
                                ${product.stock_quantity > 0 ? 'Add to Cart' : 'Out of Stock'}
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(col);
            });
        }

        function searchProducts() {
            const query = document.getElementById('searchInput').value;
            console.log('Searching for:', query);
            loadProducts({ search: query });
        }

        function filterByCategory(category) {
            console.log('Filtering by category:', category);
            document.querySelectorAll('.category-badge').forEach(badge => {
                badge.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (category === 'all') {
                loadProducts();
            } else {
                loadProducts({ category });
            }
        }

        // ============================================
        // CART
        // ============================================
        async function loadCart() {
            if (!authToken) {
                console.log('No auth token, skipping cart load');
                return;
            }

            try {
                console.log('Loading cart from backend...');
                const response = await fetch(`${API_URL}/cart`, {
                    headers: { 
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        console.log('Token expired, logging out');
                        logout();
                        return;
                    }
                    throw new Error('Failed to load cart');
                }

                cartData = await response.json();
                console.log('Cart loaded:', cartData);
                updateCartBadge();
            } catch (error) {
                console.error('‚ùå Load cart error:', error);
            }
        }

        async function addToCart(productId) {
            if (!authToken) {
                showToast('Please login to add items to cart', 'error');
                new bootstrap.Modal(document.getElementById('authModal')).show();
                return;
            }

            try {
                console.log('Adding product to cart:', productId);
                const response = await fetch(`${API_URL}/cart`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ product_id: productId, quantity: 1 })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to add to cart');
                }

                showToast('Product added to cart!');
                loadCart();
            } catch (error) {
                console.error('‚ùå Add to cart error:', error);
                showToast(error.message, 'error');
            }
        }

        function updateCartBadge() {
            const totalItems = cartData.items.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = totalItems;
            console.log('Cart badge updated:', totalItems);
        }

        async function showCart() {
            if (!authToken) {
                showToast('Please login to view cart', 'error');
                new bootstrap.Modal(document.getElementById('authModal')).show();
                return;
            }

            console.log('Showing cart...');
            await loadCart();
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');

            if (cartData.items.length === 0) {
                cartItems.innerHTML = '<div class="text-center py-5"><h5>Your cart is empty</h5><p>Start shopping to add items!</p></div>';
                cartTotal.textContent = '$0.00';
            } else {
                cartItems.innerHTML = '';
                cartData.items.forEach(item => {
                    cartItems.innerHTML += `
                        <div class="cart-item">
                            <div class="row align-items-center">
                                <div class="col-2">
                                    <img src="${item.image_url}" alt="${item.name}" 
                                         onerror="this.src='https://via.placeholder.com/80'">
                                </div>
                                <div class="col-4">
                                    <h6>${item.name}</h6>
                                    <small class="text-muted">${parseFloat(item.price).toFixed(2)} each</small>
                                </div>
                                <div class="col-3">
                                    <div class="input-group input-group-sm">
                                        <button class="btn btn-outline-secondary" 
                                                onclick="updateCartQuantity(${item.product_id}, ${item.quantity - 1})">-</button>
                                        <input type="text" class="form-control text-center" 
                                               value="${item.quantity}" readonly>
                                        <button class="btn btn-outline-secondary" 
                                                onclick="updateCartQuantity(${item.product_id}, ${item.quantity + 1})">+</button>
                                    </div>
                                </div>
                                <div class="col-2 text-end">
                                    <strong>${(item.price * item.quantity).toFixed(2)}</strong>
                                </div>
                                <div class="col-1 text-end">
                                    <button class="btn btn-sm btn-danger" 
                                            onclick="removeFromCart(${item.product_id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                cartTotal.textContent = `${parseFloat(cartData.total).toFixed(2)}`;
            }

            new bootstrap.Modal(document.getElementById('cartModal')).show();
        }

        async function updateCartQuantity(productId, newQuantity) {
            if (newQuantity <= 0) {
                await removeFromCart(productId);
                return;
            }

            try {
                console.log('Updating cart quantity:', { productId, newQuantity });
                const response = await fetch(`${API_URL}/cart/${productId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ quantity: newQuantity })
                });

                if (!response.ok) throw new Error('Failed to update cart');

                await loadCart();
                showCart();
            } catch (error) {
                console.error('‚ùå Update cart error:', error);
                showToast(error.message, 'error');
            }
        }

        async function removeFromCart(productId) {
            try {
                console.log('Removing from cart:', productId);
                const response = await fetch(`${API_URL}/cart/${productId}`, {
                    method: 'DELETE',
                    headers: { 
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) throw new Error('Failed to remove item');

                showToast('Item removed from cart');
                await loadCart();
                showCart();
            } catch (error) {
                console.error('‚ùå Remove from cart error:', error);
                showToast(error.message, 'error');
            }
        }

        // ============================================
        // CHECKOUT
        // ============================================
        async function proceedToCheckout() {
            if (cartData.items.length === 0) {
                showToast('Your cart is empty!', 'error');
                return;
            }

            console.log('Proceeding to checkout...');
            bootstrap.Modal.getInstance(document.getElementById('cartModal')).hide();
            showSection('checkout');

            const checkoutItems = document.getElementById('checkoutItems');
            const subtotal = cartData.total;

            checkoutItems.innerHTML = '';
            cartData.items.forEach(item => {
                checkoutItems.innerHTML += `
                    <div class="d-flex justify-content-between mb-2">
                        <span>${item.name} x ${item.quantity}</span>
                        <span>${(item.price * item.quantity).toFixed(2)}</span>
                    </div>
                `;
            });

            document.getElementById('checkoutSubtotal').textContent = `${subtotal.toFixed(2)}`;
            document.getElementById('checkoutTotal').textContent = `${subtotal.toFixed(2)}`;
        }

        async function completeOrder(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const btn = form.querySelector('button[type="submit"]');
            
            console.log('Completing order...');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Processing Order...';

            try {
                const address = `${formData.get('firstName')} ${formData.get('lastName')}, ${formData.get('address')}, ${formData.get('city')}, ${formData.get('postalCode')}, Phone: ${formData.get('phone')}`;
                
                const response = await fetch(`${API_URL}/orders`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        shipping_address: address,
                        payment_method: formData.get('payment_method')
                    })
                });

                const data = await response.json();

                if (!response.ok) throw new Error(data.error || 'Order failed');

                console.log('‚úÖ Order completed:', data);
                showToast(`Order placed successfully! Order ID: ${data.orderId}`);
                
                cartData = { items: [], total: 0 };
                updateCartBadge();
                form.reset();
                
                setTimeout(() => {
                    showSection('orders');
                    loadOrders();
                }, 2000);
            } catch (error) {
                console.error('‚ùå Order error:', error);
                showToast(error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-lock"></i> Complete Order';
            }
        }

        // ============================================
        // ORDERS
        // ============================================
        async function loadOrders() {
            if (!authToken) return;

            try {
                console.log('Loading orders...');
                const response = await fetch(`${API_URL}/orders`, {
                    headers: { 
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) throw new Error('Failed to load orders');

                const orders = await response.json();
                console.log('Orders loaded:', orders);
                renderOrders(orders);
            } catch (error) {
                console.error('‚ùå Load orders error:', error);
                document.getElementById('ordersList').innerHTML = '<p class="text-center">Failed to load orders</p>';
            }
        }

        function renderOrders(orders) {
            const container = document.getElementById('ordersList');
            
            if (orders.length === 0) {
                container.innerHTML = '<div class="seller-card text-center"><h5>No orders yet</h5><p>Start shopping to place your first order!</p></div>';
                return;
            }

            container.innerHTML = '';
            orders.forEach(order => {
                const statusClass = {
                    'pending': 'warning',
                    'processing': 'info',
                    'shipped': 'primary',
                    'delivered': 'success',
                    'cancelled': 'danger'
                }[order.status] || 'secondary';

                container.innerHTML += `
                    <div class="seller-card mb-3">
                        <div class="row">
                            <div class="col-md-8">
                                <h5>Order #${order.id}</h5>
                                <p class="mb-1"><strong>Date:</strong> ${new Date(order.created_at).toLocaleDateString()}</p>
                                <p class="mb-1"><strong>Items:</strong> ${order.item_count}</p>
                                <p class="mb-1"><strong>Total:</strong> ${parseFloat(order.total_amount).toFixed(2)}</p>
                                <p class="mb-1"><strong>Payment:</strong> ${order.payment_method} 
                                    <span class="badge bg-${order.payment_status === 'completed' ? 'success' : 'warning'}">${order.payment_status}</span>
                                </p>
                            </div>
                            <div class="col-md-4 text-end">
                                <span class="badge bg-${statusClass} fs-6">${order.status.toUpperCase()}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // ============================================
        // SELLER DASHBOARD
        // ============================================
        async function loadSellerStats() {
            try {
                console.log('Loading seller stats...');
                const response = await fetch(`${API_URL}/seller/stats`, {
                    headers: { 
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) throw new Error('Failed to load stats');

                const stats = await response.json();
                console.log('Seller stats loaded:', stats);
                
                document.getElementById('totalProducts').textContent = stats.total_products;
                document.getElementById('totalRevenue').textContent = `${parseFloat(stats.total_revenue).toFixed(2)}`;
                document.getElementById('totalOrders').textContent = stats.total_orders;
            } catch (error) {
                console.error('‚ùå Load stats error:', error);
            }
        }

        async function loadSellerProducts() {
            try {
                console.log('Loading seller products...');
                const response = await fetch(`${API_URL}/products?sellerId=${currentUser.id}`, {
                    headers: { 
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) throw new Error('Failed to load products');

                const products = await response.json();
                console.log('Seller products loaded:', products);
                renderSellerProducts(products);
            } catch (error) {
                console.error('‚ùå Load seller products error:', error);
            }
        }

        function renderSellerProducts(products) {
            const tbody = document.getElementById('sellerProductsList');
            
            if (products.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center">No products yet. Add your first product above!</td></tr>';
                return;
            }

            tbody.innerHTML = '';
            products.forEach(product => {
                tbody.innerHTML += `
                    <tr>
                        <td><img src="${product.image_url}" alt="${product.name}" 
                                 style="width:50px;height:50px;object-fit:cover;border-radius:5px;" 
                                 onerror="this.src='https://via.placeholder.com/50'"></td>
                        <td>${product.name}</td>
                        <td>${parseFloat(product.price).toFixed(2)}</td>
                        <td>${product.stock_quantity}</td>
                        <td><span class="badge bg-primary">${product.category}</span></td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
        }
       

        async function addProduct(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const btn = form.querySelector('button[type="submit"]');
            
            console.log('Adding product...');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Adding...';

            try {
                const productData = {
                    name: formData.get('name'),
                    description: formData.get('description'),
                    price: parseFloat(formData.get('price')),
                    category: formData.get('category'),
                    image_url: formData.get('image_url'),
                    stock_quantity: parseInt(formData.get('stock_quantity'))
                };

                console.log('Product data:', productData);

                const response = await fetch(`${API_URL}/products`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(productData)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to add product');
                }

                console.log('‚úÖ Product added successfully');
                showToast('Product added successfully!');
                form.reset();
                loadSellerStats();
                loadSellerProducts();
                loadProducts(); // Refresh main product list
            } catch (error) {
                console.error('‚ùå Add product error:', error);
                showToast(error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-plus"></i> Add Product';
            }
        }
        function registerRoutes() {

    // ============================
    // AUTH ROUTES
    // ============================
    app.post('/api/auth/register', [
        body('name').trim().notEmpty().withMessage('Name is required'),
        body('email').isEmail().withMessage('Valid email is required'),
        body('password').isLength({ min: 6 }).withMessage('Password must be at least 6 characters'),
        body('role').optional().isIn(['buyer', 'seller']).withMessage('Invalid role')
    ], async (req, res) => {
        const errors = validationResult(req);
        if (!errors.isEmpty()) {
            return res.status(400).json({ errors: errors.array() });
        }

        try {
            const { name, email, password, role = 'buyer', phone, address } = req.body;

            const [existingUsers] = await pool.query('SELECT id FROM users WHERE email = ?', [email]);
            if (existingUsers.length > 0) {
                return res.status(400).json({ error: 'Email already registered' });
            }

            const hashedPassword = await bcrypt.hash(password, 10);

            const [result] = await pool.query(
                'INSERT INTO users (name, email, password, role, phone, address) VALUES (?, ?, ?, ?, ?, ?)',
                [name, email, hashedPassword, role, phone, address]
            );

            const token = jwt.sign(
                { id: result.insertId, email, role },
                JWT_SECRET,
                { expiresIn: '7d' }
            );

            res.status(201).json({
                message: 'User registered successfully',
                token,
                user: { id: result.insertId, name, email, role }
            });
        } catch (error) {
            console.error('Register error:', error);
            res.status(500).json({ error: 'Registration failed' });
        }
    });

    app.post('/api/auth/login', [
        body('email').isEmail().withMessage('Valid email is required'),
        body('password').notEmpty().withMessage('Password is required')
    ], async (req, res) => {
        const errors = validationResult(req);
        if (!errors.isEmpty()) {
            return res.status(400).json({ errors: errors.array() });
        }

        try {
            const { email, password } = req.body;

            const [users] = await pool.query('SELECT * FROM users WHERE email = ?', [email]);
            if (users.length === 0) {
                return res.status(401).json({ error: 'Invalid credentials' });
            }

            const user = users[0];

            const isValidPassword = await bcrypt.compare(password, user.password);
            if (!isValidPassword) {
                return res.status(401).json({ error: 'Invalid credentials' });
            }

            const token = jwt.sign(
                { id: user.id, email: user.email, role: user.role },
                JWT_SECRET,
                { expiresIn: '7d' }
            );

            res.json({
                message: 'Login successful',
                token,
                user: {
                    id: user.id,
                    name: user.name,
                    email: user.email,
                    role: user.role
                }
            });
        } catch (error) {
            console.error('Login error:', error);
            res.status(500).json({ error: 'Login failed' });
        }
    });

    app.get('/api/auth/me', authenticateToken, async (req, res) => {
        try {
            const [users] = await pool.query(
                'SELECT id, name, email, role, phone, address, created_at FROM users WHERE id = ?',
                [req.user.id]
            );

            if (users.length === 0) {
                return res.status(404).json({ error: 'User not found' });
            }

            res.json(users[0]);
        } catch (error) {
            console.error('Get user error:', error);
            res.status(500).json({ error: 'Failed to fetch user' });
        }
    });


    // ============================
    // PRODUCT ROUTES
    // ============================

    app.get('/api/products', async (req, res) => {
        try {
            const { category, search } = req.query;
            let query = "SELECT * FROM products WHERE status='active'";
            const params = [];

            if (category) {
                query += " AND category = ?";
                params.push(category);
            }

            if (search) {
                query += " AND name LIKE ?";
                params.push("%" + search + "%");
            }

            const [products] = await pool.query(query, params);
            res.json(products);
        } catch (error) {
            console.error('Get products error:', error);
            res.status(500).json({ error: 'Failed to fetch products' });
        }
    });

    // (‚Ä¶ all other product routes go here EXACTLY as in your file ‚Ä¶)

    // ============================
    // CART ROUTES
    // ============================

    // (‚Ä¶ paste your full cart routes here ‚Ä¶)

    // ============================
    // ORDER ROUTES
    // ============================

    // (‚Ä¶ paste your full order routes here ‚Ä¶)

    // ============================
    // SELLER ROUTES
    // ============================

    // (‚Ä¶ paste your seller routes here ‚Ä¶)

    // ============================
    // REVIEWS
    // ============================

    // (‚Ä¶ paste your review route ‚Ä¶)

    // ============================
    // HEALTH CHECK
    // ============================
    app.get('/api/health', (req, res) => {
        res.json({ status: "OK" });
    });

}
        async function startServer() {
    await initDatabase();

    // ‚úÖ Register routes only after DB is ready
    registerRoutes();

    app.listen(PORT, () => {
        console.log(`
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  üöÄ E-Commerce API Server Running    ‚ïë
‚ïë  üì° Port: ${PORT}                      ‚ïë
‚ïë  üóÑÔ∏è  Database: MySQL                  ‚ïë
‚ïë  ‚úÖ Status: Active                    ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        `);
    });
}

        async function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) return;

            try {
                console.log('Deleting product:', productId);
                const response = await fetch(`${API_URL}/products/${productId}`, {
                    method: 'DELETE',
                    headers: { 
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) throw new Error('Failed to delete product');

                console.log('‚úÖ Product deleted');
                showToast('Product deleted successfully!');
                loadSellerStats();
                loadSellerProducts();
                loadProducts();
            } catch (error) {
                console.error('‚ùå Delete product error:', error);
                showToast(error.message, 'error');
            }
        }

        // ============================================
        // UI HELPERS
        // ============================================
        function showSection(section) {
            console.log('Showing section:', section);
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('sellerDashboard').style.display = 'none';
            document.getElementById('ordersPage').style.display = 'none';
            document.getElementById('checkoutPage').style.display = 'none';

            if (section === 'home' || section === 'products') {
                document.getElementById('mainContent').style.display = 'block';
                loadProducts();
            } else if (section === 'seller') {
                if (!currentUser || currentUser.role !== 'seller') {
                    showToast('Seller access required', 'error');
                    return;
                }
                document.getElementById('sellerDashboard').style.display = 'block';
                loadSellerStats();
                loadSellerProducts();
            } else if (section === 'orders') {
                if (!currentUser) {
                    showToast('Please login to view orders', 'error');
                    new bootstrap.Modal(document.getElementById('authModal')).show();
                    return;
                }
                document.getElementById('ordersPage').style.display = 'block';
                loadOrders();
            } else if (section === 'checkout') {
                document.getElementById('checkoutPage').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        function showToast(message, type = 'success') {
            const icon = type === 'success' ? 'check-circle' : 'exclamation-circle';
            const bgColor = type === 'success' ? 'success' : 'danger';
            
            const toastHTML = `
                <div class="toast show align-items-center text-white bg-${bgColor} border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="fas fa-${icon}"></i> ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            const container = document.querySelector('.toast-container');
            container.innerHTML = toastHTML;
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }

        // Log all API calls for debugging
        console.log('API Configuration:', { API_URL });
    </script>
</body>
</html>